{% extends "layout.html" %}
{% block content %}
<h4>当天记录</h4>
<form method="post" class="row g-3">
  <div class="col-md-3">
    <label class="form-label">日期</label>
    <input type="date" name="date" class="form-control" value="{{ date.isoformat() }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">服务项目</label>
    <select class="form-select" name="service_type">
      {% for s in service_types %}
      <option value="{{ s }}">{{ s }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">时长</label>
    <select class="form-select" name="duration">
      {% for d in durations %}
      <option value="{{ d }}">{{ d }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">技师</label>
    <select class="form-select" name="therapist_id">
      <option value="">未指定</option>
      {% for t in therapists %}
      <option value="{{ t.id }}">{{ t.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">刷卡金额 (USD)</label>
    <input type="number" step="0.01" name="card_amount" class="form-control" value="{{ record.card_amount if record else '0.00' }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">现金金额 (USD)</label>
    <input type="number" step="0.01" name="cash_amount" class="form-control" value="{{ record.cash_amount if record else '0.00' }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">客人数</label>
    <input type="number" min="1" name="customer_count" class="form-control" value="{{ record.customer_count if record else 1 }}">
  </div>
  <div class="col-md-6">
    <label class="form-label">备注</label>
    <input type="text" name="note" class="form-control" value="{{ record.note if record else '' }}">
  </div>

  <div class="col-12">
    <button class="btn btn-primary">保存今天记录</button>
    <button type="reset" class="btn btn-secondary">清空输入</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('main.history') }}">查看历史记录</a>
  </div>
</form>

<hr>
{% if record %}
<h5>最近保存（当天）</h5>
<table class="table table-sm">
  <thead><tr><th>服务</th><th>时长</th><th>技师</th><th>刷卡</th><th>现金</th><th>总额</th><th>客数</th><th>备注</th></tr></thead>
  <tbody>
    <tr>
      <td>{{ record.service_type }}</td>
      <td>{{ record.duration }}</td>
      <td>{{ record.therapist.name if record.therapist else '' }}</td>
      <td>${{ "%.2f"|format(record.card_amount) }}</td>
      <td>${{ "%.2f"|format(record.cash_amount) }}</td>
      <td>${{ "%.2f"|format(record.total_amount) }}</td>
      <td>{{ record.customer_count }}</td>
      <td>{{ record.note }}</td>
    </tr>
  </tbody>
</table>
{% endif %}
{% endblock %}
{% if record %}
<h5>最近保存（当天）</h5>
<form method="post" action="{{ url_for('main.delete_record', rid=record.id) }}" onsubmit="return confirm('确定要删除该记录吗？');">
  <table class="table table-sm">
    <thead><tr><!-- 其它表头 --><th>操作</th></tr></thead>
    <tbody>
      <tr>
        <!-- 其它数据列 -->
        <td>
          <button class="btn btn-danger btn-sm">删除</button>
        </td>
      </tr>
    </tbody>
  </table>
</form>
{% endif %}
