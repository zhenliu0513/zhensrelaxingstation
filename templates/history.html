{% extends "layout.html" %}
{% block content %}
<h3>历史记录</h3>

<form class="row g-2 mb-3" method="get" action="{{ url_for('history') }}">
  <div class="col-md-3">
    <label class="form-label">开始日期</label>
    <input class="form-control" type="date" name="start" value="{{ start }}">
  </div>
  <div class="col-md-3">
    <label class="form-label">结束日期</label>
    <input class="form-control" type="date" name="end" value="{{ end }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">排序</label>
    <select class="form-select" name="order">
      <option value="desc" {% if order=='desc' %}selected{% endif %}>新到旧</option>
      <option value="asc" {% if order=='asc' %}selected{% endif %}>旧到新</option>
    </select>
  </div>
  <div class="col-md-4 align-self-end">
    <button class="btn btn-primary">筛选</button>
    <a class="btn btn-secondary" href="{{ url_for('history') }}">重置</a>
    <a class="btn btn-outline-success" href="{{ url_for('export_csv') }}">导出为 CSV</a>
  </div>
</form>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>日期</th>
      <th>刷卡金额</th>
      <th>现金金额</th>
      <th>总金额</th>
      <th>客人数</th>
      <th>平均客单价</th>
      <th>备注</th>
    </tr>
  </thead>
  <tbody>
    {% for r in records %}
    <tr>
      <td>{{ r.date }}</td>
      <td>${{ "%.2f"|format(r.card_amount) }}</td>
      <td>${{ "%.2f"|format(r.cash_amount) }}</td>
      <td>${{ "%.2f"|format(r.total_amount) }}</td>
      <td>{{ r.customer_count }}</td>
      <td>
        {% if r.customer_count and r.customer_count > 0 %}
          ${{ "%.2f"|format(r.total_amount / r.customer_count) }}
        {% else %}
          N/A
        {% endif %}
      </td>
      <td>{{ r.note }}</td>
    </tr>
    {% else %}
    <tr>
      <td colspan="7" class="text-center">暂无记录</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
